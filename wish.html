<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>给萍萍的专属惊喜 ❤️</title>
    <style>
        /* 原有样式完全不变，此处省略重复代码 */
    </style>
</head>
<body>
    <!-- 原有DOM结构完全不变，此处省略重复代码 -->

    <script>
        // 生成动态爱心（原有）
        function createFloatingHearts() {
            const container = document.getElementById('heartContainer');
            for (let i = 0; i < 15; i++) {
                const heart = document.createElement('div');
                heart.className = 'floating-heart';
                heart.innerText = '❤️';
                heart.style.left = `${Math.random() * 100}vw`;
                heart.style.animationDelay = `${Math.random() * 8}s`;
                container.appendChild(heart);
            }
        }

        // 生成爆炸爱心（原有）
        function createExplosionHearts(x, y) {
            const container = document.getElementById('explosionContainer');
            for (let i = 0; i < 20; i++) {
                const heart = document.createElement('div');
                heart.className = 'explosion-heart';
                heart.innerText = '❤️';
                const distance = 50 + Math.random() * 150;
                const angle = Math.random() * Math.PI * 2;
                heart.style.setProperty('--x', `${Math.cos(angle) * distance}px`);
                heart.style.setProperty('--y', `${Math.sin(angle) * distance}px`);
                heart.style.left = `${x}px`;
                heart.style.top = `${y}px`;
                heart.style.animationDelay = `${Math.random() * 0.3}s`;
                container.appendChild(heart);
                setTimeout(() => heart.remove(), 1200);
            }
        }

        // 原有DOM元素获取（仅新增草莓元素到分层数组）
        const clickPrompt = document.getElementById('clickPrompt');
        const subtitleWrapper = document.getElementById('subtitleWrapper');
        const cakeWrapper = document.getElementById('cakeWrapper');
        const interactionArea = document.getElementById('interactionArea');
        const birthdayMusic = document.getElementById('birthdayMusic');
        const flame = document.getElementById('flame');
        const subtitles = [
            { id: 'subtitle1', time: 1500 }, { id: 'subtitle2', time: 1500 },
            { id: 'subtitle3', time: 1500 }, { id: 'subtitle4', time: 2000 },
            { id: 'subtitle5', time: 1500 }, { id: 'subtitle6', time: 1500 },
            { id: 'count3', time: 1000 }, { id: 'count2', time: 1000 }, { id: 'count1', time: 1000 }
        ];

        // 播放字幕（核心修改：调整蛋糕显示位置，拉开与字幕的距离）
        function playSubtitles(index = 0) {
            if (index >= subtitles.length) {
                subtitleWrapper.style.display = 'none'; // 先隐藏字幕容器
                setTimeout(() => {
                    cakeWrapper.style.display = 'block';
                    // ========== 核心修改：蛋糕位置更靠下，远离字幕区域 ==========
                    cakeWrapper.style.top = '65%'; // 从原来的50%改为65%，更靠下（手机端更明显）
                    cakeWrapper.style.transform = 'translate(-50%, -50%)'; // 保持水平+垂直居中于新的top位置
                    // ========== 修改结束 ==========
                    try { birthdayMusic.play(); } catch (err) {
                        alert("请点击页面允许播放音乐~");
                        document.body.addEventListener('click', () => birthdayMusic.play(), { once: true });
                    }
                    startCakeLayersAnimation();
                }, 1000);
                return;
            }
            document.querySelectorAll('.subtitle').forEach(el => el.classList.remove('show'));
            document.getElementById(subtitles[index].id).classList.add('show');
            setTimeout(() => playSubtitles(index + 1), subtitles[index].time);
        }

        // 启动字幕流程（原有）
        function startSubtitleFlow() {
            clickPrompt.style.display = 'none';
            subtitleWrapper.style.display = 'flex';
            playSubtitles(0);
        }

        // 蛋糕分层动画（原有）
        function startCakeLayersAnimation() {
            const layers = [
                document.querySelector('.layer1'),
                document.querySelector('.layer2'),
                document.querySelector('.layer3'),
                document.querySelector('.cream'),
                document.querySelector('.strawberry'),
                document.querySelector('.strawberry-2'),
                document.querySelector('.strawberry-3'),
                document.querySelector('.candle'),
                document.querySelector('.flame')
            ];
            
            function playNextLayer(index = 0) {
                if (index >= layers.length) {
                    setTimeout(() => {
                        document.querySelectorAll('.decor').forEach(el => el.style.display = 'block');
                        interactionArea.style.display = 'block';
                    }, 500);
                    return;
                }
                const currentLayer = layers[index];
                currentLayer.style.animationPlayState = 'running';
                currentLayer.addEventListener('animationend', () => {
                    playNextLayer(index + 1);
                }, { once: true });
            }
            playNextLayer(0);
        }

        // 交互按钮事件（原有）
        document.getElementById('unhappyBtn').onclick = () => {
            document.getElementById('happyTip').style.display = 'block';
            setTimeout(() => document.getElementById('happyTip').style.display = 'none', 3000);
        };
        document.getElementById('happyBtn').onclick = () => {
            birthdayMusic.pause();
            window.location.href = './zuihoujiemian.html';
        };
        flame.onclick = function() {
            this.classList.add('hide');
            const rect = this.getBoundingClientRect();
            createExplosionHearts(rect.left + rect.width/2, rect.top + rect.height/2);
            this.onclick = null;
        };

        // 初始化（原有）
        window.onload = function() {
            createFloatingHearts();
            document.body.addEventListener('click', startSubtitleFlow, { once: true });
        };
    </script>
</body>
</html>
